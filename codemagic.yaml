workflows:
  expo-managed-build:
    name: Expo Managed Workflow Build
    max_build_duration: 60
    instance_type: mac_mini_m1
    environment:
      node: 18
      groups:
        - default
    scripts:
      - name: Install dependencies
        script: |
          echo "Installing npm dependencies..."
          npm install --legacy-peer-deps
          # 补充 ajv 依赖
          npm install ajv@^8 ajv-keywords@^5 --save-dev
          # 确保 expo 依赖匹配
          npx expo install
          npm install -g eas-cli
      - name: Build Android APK via EAS
        script: |
          echo "Building Android APK via EAS..."
          eas build -p android --profile production --non-interactive
    artifacts:
      - build/**/*
